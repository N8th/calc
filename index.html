<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Nathan Game</title>
    <style>
      body {
        font-family: "Comic Sans MS", sans-serif;
        background-color: #333;
        color: #fff;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }

      h1 {
        color: #ffcc00;
      }

      #game-container {
        width: 100%;
        max-width: 600px;
        background-color: #444;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
        border-radius: 15px;
        text-align: center;
      }

      #chat-box {
        max-height: 300px;
        overflow-y: auto;
        margin-bottom: 20px;
        border: 2px solid #ffcc00;
        padding: 15px;
        border-radius: 10px;
        background-color: #555;
      }

      .message {
        margin-bottom: 10px;
        padding: 5px 10px;
        border-radius: 10px;
      }

      .nathan-message {
        color: #ffcc00;
        text-align: left;
        background-color: #333;
      }

      .user-message {
        color: #00ccff;
        text-align: right;
        background-color: #222;
      }

      #user-input {
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #555;
        background-color: #333;
        color: #fff;
      }

      #submit-button,
      .choice-button {
        margin-top: 10px;
        padding: 10px 15px;
        background-color: #00ccff;
        color: #fff;
        border: none;
        border-radius: 10px;
        cursor: pointer;
      }

      #submit-button:hover,
      .choice-button:hover {
        background-color: #0099cc;
      }

      .choice-button {
        background-color: #ffcc00;
        color: #333;
        margin: 5px;
      }

      .choice-button:hover {
        background-color: #cc9900;
      }

      #game-options {
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <h1>Interactive Nathan Game</h1>

    <div id="game-container">
      <div id="game-options">
        <h3>Choose a game to play:</h3>
        <button
          class="choice-button"
          onclick="startGame('21 Questions Guess Who')"
        >
          21 Questions Guess Who
        </button>
        <button
          class="choice-button"
          onclick="startGame('Riddles with Nathan')"
        >
          Riddles with Nathan
        </button>
        <button
          class="choice-button"
          onclick="startGame('Nathan Trivia Challenge')"
        >
          Nathan Trivia Challenge
        </button>
        <button class="choice-button" onclick="startGame('Custom Game')">
          Custom Game
        </button>
      </div>

      <div id="chat-box" style="display: none">
        <!-- Nathan and user messages will be displayed here -->
      </div>

      <textarea
        id="user-input"
        placeholder="Type your response here..."
        style="display: none"
      ></textarea>
      <button id="submit-button" style="display: none">Send</button>
    </div>

    <script>
      const p2 =
        "BaViLgqkjYFT0cECh8lp1P9L1aNT3BlbkFJj0oGrr73csNygyVY7v7fTbrWbN4THxHyMwv";
      const p1 = "btrjJye8RXPxMeVZ1DOxBkA";
      const p3 = "sk-proj-xAQxCapK2dLug2gN_Fwocree_qh3C6k";
      const API_TOKEN = p3 + p2 + p1;

      const chatBox = document.getElementById("chat-box");
      const userInput = document.getElementById("user-input");
      const submitButton = document.getElementById("submit-button");
      const gameOptions = document.getElementById("game-options");

      let conversationHistory = [];
      let currentGame = "";

      async function makeApiRequest(userMessage) {
        conversationHistory.push({ role: "user", content: userMessage });

        const messages = conversationHistory.map((entry) => ({
          role: entry.role,
          content: entry.content,
        }));

        try {
          const response = await fetch(
            "https://api.openai.com/v1/chat/completions",
            {
              method: "POST",
              headers: {
                Authorization: `Bearer ${API_TOKEN}`,
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: messages,
                temperature: 1,
                max_tokens: 256,
                top_p: 1,
                frequency_penalty: 0,
                presence_penalty: 0,
              }),
            }
          );

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          const nathanMessage = data.choices[0].message.content.trim();
          conversationHistory.push({
            role: "assistant",
            content: nathanMessage,
          });
          updateChatBox("nathan", nathanMessage);
          displayYesNoButtons();
        } catch (error) {
          console.error("Error:", error);
          updateChatBox(
            "nathan",
            "Oops! Something went wrong. Please try again."
          );
        }
      }

      function updateChatBox(sender, message) {
        const messageElement = document.createElement("div");
        messageElement.classList.add("message");
        messageElement.classList.add(
          sender === "nathan" ? "nathan-message" : "user-message"
        );
        messageElement.textContent = message;
        chatBox.appendChild(messageElement);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function startGame(gameChoice) {
        gameOptions.style.display = "none";
        chatBox.style.display = "block";
        userInput.style.display = "block";
        submitButton.style.display = "block";
        currentGame = gameChoice;

        let initialMessage = "";

        if (gameChoice === "21 Questions Guess Who") {
          initialMessage =
            "Think of a person, and I'll try to guess who it is by asking questions!";
        } else if (gameChoice === "Riddles with Nathan") {
          initialMessage = "I'll ask you riddles, and you try to solve them!";
        } else if (gameChoice === "Nathan Trivia Challenge") {
          initialMessage =
            "Let's play a trivia challenge! I'll ask questions, and you answer them!";
        } else if (gameChoice === "Custom Game") {
          initialMessage =
            "Welcome to the Custom Game! Let's set the rules together.";
        }

        updateChatBox("nathan", initialMessage);
        conversationHistory.push({
          role: "assistant",
          content: initialMessage,
        });
      }

      function displayYesNoButtons() {
        const yesButton = document.createElement("button");
        yesButton.textContent = "Yes";
        yesButton.classList.add("choice-button");
        yesButton.addEventListener("click", () => handleUserResponse("Yes"));

        const noButton = document.createElement("button");
        noButton.textContent = "No";
        noButton.classList.add("choice-button");
        noButton.addEventListener("click", () => handleUserResponse("No"));

        const buttonContainer = document.createElement("div");
        buttonContainer.appendChild(yesButton);
        buttonContainer.appendChild(noButton);
        chatBox.appendChild(buttonContainer);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      function handleUserResponse(response) {
        updateChatBox("user", response);
        conversationHistory.push({ role: "user", content: response });

        // Remove the Yes/No buttons after a response
        const buttonContainer = chatBox.querySelector("div");
        if (buttonContainer) {
          buttonContainer.remove();
        }

        makeApiRequest(response);
      }

      submitButton.addEventListener("click", () => {
        const userMessage = userInput.value.trim();
        if (userMessage) {
          updateChatBox("user", userMessage);
          userInput.value = "";
          makeApiRequest(userMessage);
        }
      });
    </script>
  </body>
</html>
